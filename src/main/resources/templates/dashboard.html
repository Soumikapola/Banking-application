<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Dashboard</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>

<body>

    <div class="container">
        <div class="header">
            <h1>Welcome, <a href="/profile" th:text="${user.username}"
                    style="text-decoration: none; color: #d35400;">User</a>!</h1>
            <form action="/logout" method="post" style="display:inline;">
                <button type="submit" class="btn btn-red" style="padding: 5px 10px; font-size: 14px;">Logout</button>
            </form>
        </div>

        <div class="balance-card">
            <h2>Current Balance</h2>
            <h1 th:text="${'$' + account.balance}">$0.00</h1>
            <p>Account Number: <span th:text="${account.accountNumber}">123</span></p>
        </div>

        <div style="display: flex; gap: 20px; margin-bottom: 15px; justify-content: center; flex-wrap: wrap;">
            <form th:action="@{/deposit}" method="post" style="display:inline;">
                <input type="number" name="amount" placeholder="Deposit Amount" required
                    style="width: 140px; padding: 10px;" min="1">
                <button type="submit" class="btn btn-nude">Deposit</button>
            </form>

            <form th:action="@{/withdraw}" method="post" style="display:inline;">
                <input type="number" name="amount" placeholder="Withdraw Amount" required
                    style="width: 140px; padding: 10px;" min="1">
                <button type="submit" class="btn btn-nude-dark">Withdraw</button>
            </form>
        </div>

        <div style="display: flex; justify-content: center; margin-bottom: 30px;">
            <a href="/transfer" class="btn btn-primary"
                style="padding: 12px 40px; width: 100%; max-width: 300px;">Transfer Money</a>
        </div>

        <h3>Transaction History</h3>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Details</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="t : ${transactions}">
                    <td th:text="${#temporals.format(t.timestamp, 'yyyy-MM-dd HH:mm')}">Date</td>

                    <td th:text="${t.type}">TRANSFER</td>

                    <td>
                        <span th:if="${t.type == 'DEPOSIT'}">Cash Deposit</span>
                        <span th:if="${t.type == 'WITHDRAW'}">Cash Withdrawal</span>
                        <span th:if="${t.type == 'TRANSFER'}">
                            <span th:if="${t.sourceAccount.id == account.id}">Sent to <strong
                                    th:text="${t.targetAccount.user.username}"></strong></span>
                            <span th:if="${t.sourceAccount.id != account.id}">Received from <strong
                                    th:text="${t.sourceAccount.user.username}"></strong></span>
                        </span>
                    </td>

                    <td th:with="isPlus=${t.type == 'DEPOSIT' || (t.type == 'TRANSFER' && t.targetAccount.id == account.id)}"
                        th:style="${isPlus ? 'color: green; font-weight: bold;' : 'color: red; font-weight: bold;'}"
                        th:text="${(isPlus ? '+' : '-') + '$' + t.amount}">Amount</td>
                </tr>
                <tr th:if="${#lists.isEmpty(transactions)}">
                    <td colspan="4" style="text-align: center;">No transactions found.</td>
                </tr>
            </tbody>
        </table>
    </div>

</body>

</html>